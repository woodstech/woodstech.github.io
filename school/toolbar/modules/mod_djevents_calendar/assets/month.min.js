(function(e){var t=function(t){var o=this;o.container=jQuery(t),o.tablewrap=o.container.find(".djev_calendar_wrap").first(),o.loader=o.container.find(".djev_loader").first(),o.responseContainer=e('<div style="display: none; visibility: hidden;" />'),o.responseContainer.appendTo(o.container),o.days=o.tablewrap.find(".active-day a"),o.tip_position=o.container.attr("data-tooltip-position")||"top",o.tip_open=o.container.attr("data-tooltip-open")||"mouseenter",o.tip_close=o.container.attr("data-tooltip-close")||"click",o.attachDaysEvents(o.days),o.container.find(".next-month").on("click",function(e){e.preventDefault(),o.sendXhr(1,o.tablewrap.attr("data-month"))}),o.container.find(".prev-month").on("click",function(e){e.preventDefault(),o.sendXhr(-1,o.tablewrap.attr("data-month"))})};t.prototype.xhr=null,t.prototype.sendXhr=function(t,o){var a=this;if(!a.xhr||4==a.xhr.readyState){a.loader.css("display","block");var n=a.container.attr("data-baseurl"),r=a.container.attr("data-module");a.xhr=e.ajax({url:n,method:"post",data:"option=com_djevents&task=getMonth&format=raw&last_date="+o+"&direction="+t+"&module="+r}).done(function(e){""!=e&&a.setMonth(e)}).always(function(){a.loader.css("display","none")})}},t.prototype.setMonth=function(e){var t=this;t.responseContainer.html(e);var o=t.responseContainer.find(".active-day a");t.attachDaysEvents(o),t.tablewrap.replaceWith(t.responseContainer.find(".djev_calendar_wrap")),t.responseContainer.empty(),t.tablewrap=t.container.find(".djev_calendar_wrap").first(),t.days=t.tablewrap.find(".active-day a")},t.prototype.attachDaysEvents=function(t){var o=this;t.popover({animation:!1,html:!0,placement:o.tip_position,trigger:"manual",container:"body"}),"click"==o.tip_open?t.on("click",function(o){o.stopPropagation();var a=e(this);a.hasClass("open-day")||o.preventDefault(),t.popover("hide").removeClass("open-day"),a.popover("show").addClass("open-day")}):(t.on("mouseenter",function(o){o.stopPropagation();var a=e(this);a.hasClass("open-day")||(t.popover("hide").removeClass("open-day"),a.popover("show").addClass("open-day"))}),t.on("click focus",function(t){t.stopPropagation(),e(this).trigger("mouseenter")})),"click"==o.tip_close?e(document.body).on("click",function(o){e(o.target).parents(".popover").length||t.popover("hide").removeClass("open-day")}):(o.container.on("mouseleave",function(o){o.stopPropagation(),t.hasClass("open-day")&&!e(".popover:hover").length&&t.popover("hide").removeClass("open-day")}),e(document).on("mouseleave",".popover-content",function(){t.hasClass("open-day")&&t.popover("hide").removeClass("open-day")}))},e(document).ready(function(){e(".djev_calendar_month").each(function(){new t(this)})})})(jQuery);